<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="keywords" content="what_is_dragonfly" />
    <meta name="description" content="what_is_dragonfly" />
    <!-- 网页标签标题 -->
    <title>what_is_dragonfly</title>
    <link rel="shortcut icon" href="/img/favicon.ico"/>
    <link rel="stylesheet" href="/build/documentation.css" />
  </head>
  <body>
    <div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="https://img.alicdn.com/tfs/TB1ThlOucfpK1RjSZFOXXa6nFXa-266-72.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a href="/zh-cn/docs/overview/what_is_dragonfly.html" target="_self">文档</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/blog/index.html" target="_self">博客</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/community/index.html" target="_self">社区</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="https://img.alicdn.com/tfs/TB1sfAnt9zqK1RjSZFHXXb3CpXa-160-160.png" class="front-img"/><span>文档</span><img src="https://img.alicdn.com/tfs/TB1sfAnt9zqK1RjSZFHXXb3CpXa-160-160.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>Dragonfly</span><ul><li style="height:108px;overflow:hidden" class="menu-item menu-item-level-2"><span>概述<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/overview/what_is_dragonfly.html" target="_self">什么是 Dragonfly？</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/overview/terminology.html" target="_self">术语表</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/quickstart.html" target="_self">快速开始</a></li><li style="height:216px;overflow:hidden" class="menu-item menu-item-level-2"><span>使用指南<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/userguide/install_server.html" target="_self">安装服务端</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/userguide/install_client.html" target="_self">安装客户端</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/userguide/download_files.html" target="_self">下载文件</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/userguide/supernode_configuration.html" target="_self">超级节点配置</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/userguide/multi_machines_deployment.html" target="_self">多机部署</a></li></ul></li><li style="height:108px;overflow:hidden" class="menu-item menu-item-level-2"><span>CLI 参考<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/cli_ref/dfdaemon.html" target="_self">dfdaemon</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/cli_ref/dfget.html" target="_self">dfget</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/api.html" target="_self">API 参考</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/faq.html" target="_self">常见问题</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>什么是 Dragonfly？</h1>
<p>Dragonfly 是一款基于 P2P 的智能镜像和文件分发工具。它旨在提高文件传输的效率和速率，最大限度地利用网络带宽，尤其是在分发大量数据时，例如应用分发、缓存分发、日志分发和镜像分发。</p>
<p>在阿里巴巴，Dragonfly 每个月会被调用 20 亿次，分发的数据量高达 3.4PB。Dragonfly 已成为阿里巴巴基础设施中的重要一环。</p>
<p>尽管容器技术大部分时候简化了运维工作，但是它也带来了一些挑战：例如镜像分发的效率问题，尤其是必须在多个主机上复制镜像分发时。</p>
<p>Dragonfly 在这种场景下能够完美支持 Docker 和 <a href="https://github.com/alibaba/pouch">PouchContainer</a>。它也兼容其他格式的容器。相比原生方式，它能将容器分发速度提高 57 倍，并让 Registry 网络出口流量降低 99.5%。</p>
<p>Dragonfly 能让所有类型的文件、镜像或数据分发变得简单而经济。</p>
<h2>Dragonfly 有何优势？</h2>
<p>本项目是阿里巴巴所使用的 Dragonfly 的开源版本。它具备以下特性：</p>
<p>**注意：**更多面向阿里巴巴内部的功能也将逐步开源。敬请期待！</p>
<ul>
<li><strong>基于 P2P 的文件分发</strong>：通过利用 P2P 技术进行文件传输，它能最大限度地利用每个对等节点（Peer）的带宽资源，以提高下载效率，并节省大量跨机房带宽，尤其是昂贵的跨境带宽。</li>
<li><strong>非侵入式支持所有类型的容器技术</strong>：Dragonfly 可无缝支持多种容器用于分发镜像。</li>
<li><strong>机器级别的限速</strong>：除了像许多其他下载工具（例如 wget 和 curl）那样的针对当前下载任务的限速之外，Dragonfly 还支持针对整个机器的限速。</li>
<li><strong>被动式 CDN</strong>：这种 CDN 机制可防止重复远程下载。</li>
<li><strong>高度一致性</strong>：Dragonfly 可确保所有下载的文件是一致的，即使用户不提供任何检查代码（MD5）。</li>
<li><strong>磁盘保护和高效 IO</strong>：预检磁盘空间、延迟同步、以最佳顺序写文件分块、隔离网络-读/磁盘-写等等。</li>
<li><strong>高性能</strong>：SuperNode 是完全闭环的，意味着它不依赖任何数据库或分布式缓存，能够以极高性能处理请求。</li>
<li><strong>自动隔离异常</strong>：Dragonfly 会自动隔离异常节点（对等节点或 SuperNode）来提高下载稳定性。</li>
<li><strong>对文件源无压力</strong>：一般只有少数几个 SuperNode 会从源下载文件。</li>
<li><strong>支持标准 HTTP 头文件</strong>：支持通过 HTTP 头文件提交鉴权信息。</li>
<li><strong>有效的 Registry 鉴权并发控制</strong>：减少对 Registry 鉴权服务的压力。</li>
<li><strong>简单易用</strong>：仅需极少的配置。</li>
</ul>
<h2>它与传统解决方案相比怎么样？</h2>
<p>我们开展了一个实验来对比 Dragonfly 和 wget 的性能。</p>
<table>
<thead>
<tr>
<th>测试环境</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Dragonfly 服务端</td>
<td>2 * (24核 64GB内存 2000Mb/s)</td>
</tr>
<tr>
<td>文件源服务端</td>
<td>2 * (24核 64GB内存 2000Mb/s)</td>
</tr>
<tr>
<td>客户端</td>
<td>4核 8GB内存 200Mb/s</td>
</tr>
<tr>
<td>目标文件大小</td>
<td>200MB</td>
</tr>
<tr>
<td>实验日期</td>
<td>2016年4月20日</td>
</tr>
</tbody>
</table>
<p>实验结果如下图所示。</p>
<p><img src="../img/performance.png" alt="How it stacks up"></p>
<p>如统计图所示，对于 Dragonfly，不论有多少个客户端同时下载，平均下载时间始终约为 12 秒。但是对于 wget，下载速度会随着客户端数量的增加不断增加。当 wget 客户端数量达到 1,200 个时，文件源崩溃了，因此无法继续为任何客户端提供服务。</p>
<h2>它的工作原理是什么？</h2>
<p>Dragonfly 下载普通文件和下载容器镜像的工作原理略有不同。</p>
<h3>下载普通文件</h3>
<p>SuperNode 充当 CDN，并负责调度对等节点（Peer）之间的文件分块传输。dfget 是 P2P 客户端，也称为“Peer”（对等节点），主要用于下载和共享文件分块。</p>
<p><img src="../img/dfget.png" alt="Downloading General Files"></p>
<h3>下载镜像文件</h3>
<p>Registry 类似于文件服务器。dfget proxy 也称为 dfdaemon，会拦截来自 docker pull 或 docker push 的 HTTP 请求，然后使用 dfget 来处理那些跟镜像分层相关的请求。</p>
<p><img src="../img/dfget-combine-container.png" alt="Downloading Container Images"></p>
<h3>下载文件分块</h3>
<p>每个文件会被分成多个分块，并在对等节点之间传输。一个对等节点就是一个 P2P 客户端。SuperNode 会判断本地是否存在对应的文件。如果不存在，则会将其从文件服务器下载到 SuperNode。</p>
<p><img src="../img/distributing.png" alt="How file blocks are downloaded"></p>
</div></section><footer class="footer-container"><div class="footer-body"><img src="https://img.alicdn.com/tfs/TB1H9Eht9zqK1RjSZPxXXc4tVXa-266-72.png"/><div class="cols-container"><div class="col col-12"><h3>愿景</h3><p>Dragonfly 致力于解决大规模文件分发的效率问题，打造容器镜像分发的第一解决方案和标准规范，并为用户提供高可用、高效率以及简单易用的文件及镜像分发服务。</p></div><div class="col col-6"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/overview/what_is_dragonfly.html" target="_self">什么是 Dragonfly？</a></dd><dd><a href="/zh-cn/docs/quickstart.html" target="_self">快速开始</a></dd><dd><a href="/en-us/docs/userguide/install_server.html" target="_self">安装服务端</a></dd><dd><a href="/en-us/docs/userguide/install_client.html" target="_self">安装客户端</a></dd><dd><a href="/en-us/docs/userguide/download_files.html" target="_self">下载文件</a></dd></dl></div><div class="col col-6"><dl><dt>资源</dt><dd><a href="/zh-cn/blog/index.html" target="_self">博客</a></dd><dd><a href="/zh-cn/community/index.html" target="_self">社区</a></dd></dl></div></div><div class="copyright"><span>Copyright © 2018 dragonflyoss<!-- --> | <a href="https://www.cnzz.com/stat/website.php?web_id=1275746144" target="_blank"><img border="0" hspace="0" vspace="0" src="https://icon.cnzz.com/img/pic.gif"/></a></span></div></div></footer></div></div>
    <script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
    <script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
    <script>
      window.rootPath = '';
    </script>
    <script src="/build/documentation.js"></script>
    <script src="https://s23.cnzz.com/z_stat.php?id=1275746144&web_id=1275746144&show=none" language="JavaScript"></script>
  </body>
</html>
